<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book a Meeting | jemima.ai</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    /* Reset */
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    :root{
      --primary:#1a1a2e;
      --accent:#4f46e5;
      --light:#ffffff;
      --dark:#000000;
      --gray:#4a4a4a;
      --light-gray:#f5f7fa;
      --transition:all 0.3s ease;
    }
    body{
      font-family:"Poppins",sans-serif;
      background:linear-gradient(to top right,#ffd6e7 10%,#d6eaff 90%);
      color:var(--dark);
      min-height:100vh;
      line-height:1.6;
      overflow-x:hidden;
    }
    .container{width:100%;max-width:1200px;margin:0 auto;padding:0 20px;}
    header{padding:25px 0;position:fixed;top:0;width:100%;z-index:1000;
      background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);
      box-shadow:0 2px 10px rgba(0,0,0,0.05);}
    .header-container{display:flex;justify-content:space-between;align-items:center;}
    .logo{font-size:1.8rem;font-weight:700;color:var(--dark);text-decoration:none;letter-spacing:-0.5px;}
    .logo span{color:var(--accent);}
    nav ul{display:flex;list-style:none;}
    nav ul li{margin-left:30px;}
    nav ul li a{color:var(--dark);text-decoration:none;font-weight:500;font-size:1rem;
      position:relative;transition:var(--transition);}
    nav ul li a:hover{color:var(--accent);}
    nav ul li a::after{content:"";position:absolute;bottom:-5px;left:0;width:0;height:2px;
      background:var(--accent);transition:var(--transition);}
    nav ul li a:hover::after{width:100%;}
    .mobile-menu-btn{display:none;background:none;border:none;color:var(--dark);
      font-size:1.5rem;cursor:pointer;}
    .booking-main{padding-top:100px;padding-bottom:80px;}
    .booking-hero{text-align:center;padding:40px 20px;max-width:900px;margin:0 auto;}
    .booking-hero h1{font-size:3rem;font-weight:800;margin-bottom:15px;
      letter-spacing:-1px;line-height:1.2;color:var(--dark);}
    .booking-hero span{color:var(--accent);}
    .booking-hero p{font-size:1.3rem;color:var(--gray);max-width:600px;margin:0 auto;
      line-height:1.6;font-weight:400;}
      
    footer{background:var(--dark);padding:40px 0;color:#fff;margin-top:80px;}
    footer p{text-align:center;font-size:0.9rem;color:#a0aec0;}
    @media(max-width:768px){
      .booking-hero h1{font-size:2.4rem;}
      .mobile-menu-btn{display:block;margin-left:auto;}
      nav ul{display:none;flex-direction:column;position:absolute;top:80px;left:0;
        width:100%;background:#fff;padding:20px 0;
        box-shadow:0 10px 15px rgba(0,0,0,0.1);}
      nav ul.show{display:flex;}
      nav ul li{text-align:center;margin:10px 0;}
    }

    /* ---------- Form Section (Styled like Pre-Footer) ---------- */
    .form-section {
        background: var(--accent);
        padding: 60px 0;
        border-radius: 30px;
        margin: 50px 0;
        color: white;
    }

    .form-section .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        max-width: 1200px;
    }

    .form-section h2 {
        font-size: 2.2rem;
        margin-bottom: 20px;
        font-weight: 600;
    }

    .form-section p {
        max-width: 700px;
        margin-bottom: 30px;
        font-size: 1.1rem;
        line-height: 1.7;
    }

    .form-container {
        width: 100%;
        max-width: 600px;
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin: 0 auto;
    }

    .booking-form {
        display: grid;
        gap: 20px;
    }

    .booking-form label {
        font-weight: 600;
        color: var(--dark);
        display: block;
        margin-bottom: 8px;
    }

    .booking-form input,
    .booking-form select {
        width: 100%;
        padding: 14px 18px;
        font-size: 1rem;
        border: 1px solid #ddd;
        border-radius: 10px;
        background: var(--light-gray);
    }

    .booking-form button {
        background: var(--accent);
        color: #fff;
        padding: 16px 45px;
        font-size: 1.1rem;
        font-weight: 600;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: var(--transition);
        width: 100%;
        margin-top: 10px;
    }

    .booking-form button:hover {
        background: var(--primary);
    }

    #formMsg {
        margin-top: 20px;
        font-weight: 600;
        color: var(--dark);
        text-align: center;
    }

    @media (max-width: 768px) {
        .form-section {
            padding: 50px 20px;
            border-radius: 20px;
        }
        
        .form-section h2 {
            font-size: 1.8rem;
        }
        
        .form-section p {
            font-size: 1rem;
        }
        
        .form-container {
            padding: 30px;
        }
    }
  </style>
</head>
<body>
  <header aria-label="Main header">
    <div class="container header-container">
      <a href="/" class="logo">jemima<span>.ai</span></a>
      <button class="mobile-menu-btn" aria-label="Toggle menu">
        <i class="fas fa-bars"></i>
      </button>
      <nav aria-label="Primary">
        <ul>
          <li><a href="solutions.html">Solutions</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="pricing.html">Pricing</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="booking-main" id="main">
    <div class="container">
      <section class="booking-hero" aria-labelledby="hero-heading">
        <h1 id="hero-heading">Book a <span>meeting</span> with us</h1>
        <p>Select a day and a time that fits your schedule. We will e-mail a confirmation.</p>
      </section>
    </div>
  </main>

  <!-- Form Section with Booking Form -->
  <section class="form-section">
    <div class="container">
      <h2>Reserve your slot</h2>
      <p>Fill out the form below to book your meeting with our team.</p>
      
      <div class="form-container">
        <form class="booking-form" id="bookingForm" autocomplete="on">
          <div>
            <label for="firstName">First name</label>
            <input
              type="text"
              id="firstName"
              name="firstName"
              autocomplete="given-name"
              placeholder="Jane"
              required
            />
          </div>
          <div>
            <label for="lastName">Last name</label>
            <input
              type="text"
              id="lastName"
              name="lastName"
              autocomplete="family-name"
              placeholder="Doe"
              required
            />
          </div>
          <div>
            <label for="company">Company</label>
            <input
              type="text"
              id="company"
              name="company"
              autocomplete="organization"
              placeholder="Your company"
            />
          </div>
          <div>
            <label for="phone">Telephone number</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              autocomplete="tel"
              placeholder="01234567890"
            />
          </div>
          <div>
            <label for="email">Email address</label>
            <input
              type="email"
              id="email"
              name="email"
              autocomplete="email"
              placeholder="you@example.com"
              required
            />
          </div>
          <div>
            <label for="day">Choose a day</label>
            <input
              type="date"
              id="day"
              name="day"
              required
            />
          </div>
          <div>
            <label for="slot">Choose a time</label>
            <select
              id="slot"
              name="slot"
              required
            >
              <option value="">Pick a day first</option>
            </select>
          </div>

          <input type="hidden" id="pageUrl" name="pageUrl" value=""/>

          <button type="submit">Book now</button>
        </form>
        <p id="formMsg"></p>
      </div>
    </div>
  </section>

  <footer aria-label="Footer">
    <div class="container">
      <p>&copy; 2025 jemima.ai. All rights reserved.</p>
    </div>
  </footer>

<script>
  // Updated single endpoint
  const BOOKING_URL = 'https://jemima-ai.app.n8n.cloud/webhook/unified-booking-endpoint';
  const TIME_ZONE   = 'Europe/London';

  document.addEventListener('DOMContentLoaded', () => {
    const dayInput   = document.getElementById('day');
    const slotSelect = document.getElementById('slot');
    const form       = document.getElementById('bookingForm');
    const formMsg    = document.getElementById('formMsg');
    const pageUrlIn  = document.getElementById('pageUrl');

    // Set page URL
    pageUrlIn.value = window.location.href;

    // Event listeners
    dayInput.addEventListener('change', fetchTimes);
    form.addEventListener('submit', submitBooking);

    async function fetchTimes() {
      const day = dayInput.value;
      if (!day) {
        slotSelect.innerHTML = '<option value="">Pick a day first</option>';
        return;
      }

      slotSelect.disabled = true;
      slotSelect.innerHTML = '<option>Loading…</option>';

      try {
        const res  = await fetch(BOOKING_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'check_availability',
            day: day
          })
        });

        const data = await res.json();

        // Log raw response so you can check its structure
        console.log('Availability response:', data);

        // Unpack array or object, then look under data or body if needed
        let payload = data;
        if (Array.isArray(payload) && payload.length) {
          payload = payload[0];
        }
        payload = payload.data ?? payload.body ?? payload;

        const busyArr   = payload.busy  || [];
        const freeSlots = payload.slots || [];

        if (!Array.isArray(freeSlots) || freeSlots.length === 0) {
          slotSelect.innerHTML = '<option value="">No slots available</option>';
        } else {
          slotSelect.innerHTML = '<option value="">Select a time</option>';
          freeSlots.forEach(s => {
            // only include slots for the chosen day
            if (!s.startsWith(day)) return;
            const t = s.slice(11,16);
            slotSelect.insertAdjacentHTML(
              'beforeend',
              `<option value="${s}">${t}</option>`
            );
          });
          // if none left for that day show message
          if (slotSelect.options.length === 1) {
            slotSelect.innerHTML = '<option value="">No slots available</option>';
          }
        }
      } catch (e) {
        slotSelect.innerHTML = '<option value="">Error loading slots</option>';
      } finally {
        slotSelect.disabled = false;
      }
    }

    async function submitBooking(e) {
      e.preventDefault();
      formMsg.textContent = 'Sending…';

      const payload = {
        firstName: document.getElementById('firstName').value,
        lastName:  document.getElementById('lastName').value,
        company:   document.getElementById('company').value,
        phone:     document.getElementById('phone').value,
        email:     document.getElementById('email').value,
        slot:      slotSelect.value,
        pageUrl:   pageUrlIn.value,
        timeZone:  TIME_ZONE
      };

      try {
        const res = await fetch(BOOKING_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'create_booking',
            ...payload
          })
        });

        if (res.ok) {
          form.reset();
          slotSelect.innerHTML = '<option value="">Pick a day first</option>';
          formMsg.textContent   = 'Your meeting is confirmed. Check your inbox.';
        } else if (res.status === 409) {
          formMsg.textContent = 'That time has just been taken. Please choose another.';
          fetchTimes();
        } else {
          formMsg.textContent = 'An error occurred. Please try again later.';
        }
      } catch (e) {
        formMsg.textContent = 'Could not reach the server. Try again later.';
      }
    }
  });
</script>
</body>
</html>